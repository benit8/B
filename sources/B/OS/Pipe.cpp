/*
** B, 2019
** Pipe.cpp
*/

#include "Pipe.hpp"

////////////////////////////////////////////////////////////////////////////////

namespace B
{

////////////////////////////////////////////////////////////////////////////////

Pipe::Pipe()
{
	m_ok = ::pipe(m_fds) == 0;
}

Pipe::Pipe(Pipe::Flags flags)
{
	m_ok = ::pipe2(m_fds, static_cast<int>(flags)) == 0;
}

Pipe::~Pipe()
{
	if (m_fds[0] != -1) {
		::close(m_fds[0]);
		m_fds[0] = -1;
	}
	if (m_fds[1] != -1) {
		::close(m_fds[1]);
		m_fds[1] = -1;
	}
}

////////////////////////////////////////////////////////////////////////////////

void Pipe::close()
{
	::close(in());
	::close(out());
	m_fds[0] = -1;
	m_fds[1] = -1;
}

////////////////////////////////////////////////////////////////////////////////

}